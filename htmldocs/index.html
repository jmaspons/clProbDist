<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>clProbDist: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">clProbDist
   </div>
   <div id="projectbrief">An OpenCL library for probability distributions</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Introduction </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We introduce clProbDist, an OpenCL library for probability distributions. It provides facilities for evaluating probability density or mass functions, distribution functions and their inverses, and reliability functions, currently for five distributions: normal, lognormal, exponential, gamma and Poisson. Applications include nonuniform variate generation, computing confidence intervals, computing \(p\)-values for statistical tests, computing densities to evaluate the likelihood function of a sample, etc.</p>
<p>This library, in its current state, defines a framework for working with probability distributions in OpenCL, and to show some working examples. Dozens of additional distributions need to be contributed to clProbDist to make it a mature library.</p>
<p>clProbDist allows users to generate nonuniform variates (see <a class="el" href="index.html#example_poissongen">Example 2: non-uniform variate generation</a> for illustration) through inversion only. Other (possibly faster) methods, including acceptance-rejection based approaches, need to be implemented somewhere else. The inversion method relies on evaluating the inverse cumulative distribution function (CDF) of a given distribution. For certain distributions, it may be profitable to compute lookup arrays in advance and use them to evaluate the inverse CDF repeatedly with the same parameters, as when generating many random variates from the same distribution. clProbDist provides facilities to do so (see <a class="el" href="index.html#example_poissongen_obj">Example 3: non-uniform variate generation revisited</a> for an example).</p>
<h3>What to read next?</h3>
<ul>
<li><a class="el" href="index.html#distributions">Implemented distributions</a></li>
<li><a class="el" href="index.html#basic_usage">Basic usage</a></li>
<li><a class="el" href="clProbDist__template_8h.html">API supported by each probability distribution </a> presented in a generic fashion</li>
<li><a class="el" href="clProbDist_8h.html">API not related to specific probability distributions </a></li>
<li><a class="el" href="index.html#configuration">Configuration</a></li>
<li><a class="el" href="index.html#mem_types">Device memory types</a> (advanced usage)</li>
</ul>
<h1><a class="anchor" id="basic_usage"></a>
Basic usage</h1>
<h2><a class="anchor" id="prefixes"></a>
Distributions, prefixes and headers</h2>
<p>The API is almost the same for every distribution. It is described in detail in <a class="el" href="clProbDist__template_8h.html" title="Template of the API for specific probability distributions (not to be included as is!) ...">clProbDist_template.h</a>. Each distribution has its own header file (which is normally the lowercase name of the distribution, with a <code>.h</code> or <code>.clh</code> extension on the host or device, respectively), and each function contains the name of the distribution in its prefix (listed in <a class="el" href="index.html#distributions">Implemented distributions</a>). In the <a class="el" href="clProbDist__template_8h.html">generic probability distribution API reference</a>, the distribution-specific part of the prefix is not shown.</p>
<p>For example, functions from the <a class="el" href="index.html#normal_dist">Normal distribution</a> API have names that begin with <code>clprobdistNormal</code> and are declared in the <a class="el" href="normal_8h.html" title="API of the normal distribution. ">normal.h</a> header file. In particular, the probability density function <a class="el" href="clProbDist__template_8h.html#a8844ff64e6c7e186c605037b7db4b26e" title="Probability density function [device]. ">clprobdistDensity()</a>, the cumulative distribution function <a class="el" href="clProbDist__template_8h.html#aea1150c8e1520c2ab3090549df04b2cc" title="Cumulative density function [device]. ">clprobdistCDF()</a> and its inverse <a class="el" href="clProbDist__template_8h.html#a6c2599fa606512e450bb04a0d4f47df9" title="Inverse cumulative density function [device]. ">clprobdistInverseCDF()</a> from the generic API, expand to <a class="el" href="normal_8clh.html#a8170fca26c3da0ef3c6c707a76750ce5" title="Probability density function [device]. ">clprobdistNormalDensity()</a>, <a class="el" href="normal_8clh.html#a7326d577ed61cb722c226e8e824509a2" title="Cumulative density function [device]. ">clprobdistNormalCDF()</a> and <a class="el" href="normal_8clh.html#ae3a8eac03d66690b485376d0fbb65fa0" title="Inverse cumulative density function [device]. ">clprobdistNormalInverseCDF()</a>, respectively, for the normal distribution. More concretely, to store in <code>p</code> the probability density of <code>x</code> in a normal distribution of mean \(\mu\) = <code>mu</code> and standard deviation \(\sigma\) = <code>sigma</code>, one would invoke </p><div class="fragment"><div class="line">cl_double p = <a class="code" href="normal_8clh.html#a8170fca26c3da0ef3c6c707a76750ce5">clprobdistNormalDensity</a>(mu, sigma, x, NULL);</div>
</div><!-- fragment --><p> Note that <code>x</code>, <code>mu</code> and <code>sigma</code> in the above are all floating-point values of type <code>cl_double</code>. The last argument can be used for reporting errors, but errors are ignored here by passing <code>NULL</code>.</p>
<h2><a class="anchor" id="example_ci"></a>
Example 1: computing a confidence interval</h2>
<p>The following code defines a function (on the host) that computes a normal confidence interval of level <code>level</code> on the mean of a set of <code>n</code> observations of type <code>cl_double</code> stored in the array <code>observations</code>. This assumes, of course, that the mean is normally distributed. The lower and upper bounds are returned in the <code>lower</code> and <code>upper</code> variables, respectively: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="normal_8h.html">clProbDist/normal.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span> <span class="comment">// for sqrt()</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> normalConfidenceInterval(cl_int n, cl_double* observations, cl_double level,</div>
<div class="line">                              cl_double* lower, cl_double* upper)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// compute sample average and variance</span></div>
<div class="line">    cl_double sum = 0.0;</div>
<div class="line">    cl_double sum_squares = 0.0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; i++) {</div>
<div class="line">        sum         += observations[i];</div>
<div class="line">        sum_squares += observations[i] * observations[i];</div>
<div class="line">    }</div>
<div class="line">    cl_double average  = sum / n;</div>
<div class="line">    cl_double variance = (sum_squares - average * sum) / (n - 1);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// compute normal distribution parameters</span></div>
<div class="line">    cl_double mu       = average;</div>
<div class="line">    cl_double sigma    = sqrt(variance / n);</div>
<div class="line">    <span class="comment">// compute confidence interval</span></div>
<div class="line">    *lower = <a class="code" href="normal_8clh.html#ae3a8eac03d66690b485376d0fbb65fa0">clprobdistNormalInverseCDF</a>(mu, sigma, 0.5 * (1.0 - level), NULL);</div>
<div class="line">    *upper = <a class="code" href="normal_8clh.html#ae3a8eac03d66690b485376d0fbb65fa0">clprobdistNormalInverseCDF</a>(mu, sigma, 0.5 * (1.0 + level), NULL);</div>
<div class="line">}</div>
</div><!-- fragment --> <sup title="Because there will eventually be many distributions with many
header files, I deemed it best to group them into a directory (named
clProbDist).  On Linux systems, this helps to avoid cluttering the standard
include directory.
Numerous multi-header C libraries (OpenCL, Cairo, GNU Scientific Library, GTK+
3.0, libxml 2, SDL, OpenGL) put their header files in a subdirectory named
after the library.">[note]</sup> The first part of <code>normalConfidenceInterval()</code> simply computes the sample average and variance of the observations. The second part illustrates how to evaluate the inverse normal distribution function by invoking <a class="el" href="normal_8clh.html#ae3a8eac03d66690b485376d0fbb65fa0" title="Inverse cumulative density function [device]. ">clprobdistNormalInverseCDF()</a> with the normal distribution parameters \(\mu\)=<code>mu</code> and \(\sigma\)=<code>sigma</code> (the mean and variance) as its first arguments, for two different quantiles. The last argument is used for reporting errors, which are ignored here by setting it to <code>NULL</code>.</p>
<p>A more efficient implementation would compute the half width of the interval using a single call to <a class="el" href="normal_8clh.html#a76cd59d390416fc2a83ef98488e7ef7e" title="Inverse cumulative density function [device]. ">clprobdistStdNormalInverseCDF()</a> from the <a class="el" href="index.html#stdnormal_dist">Standard normal distribution</a> API. The standard normal distribution always has zero mean and a unit variance, so functions from its API do not take any distribution parameters. With this, we could replace the last four instructions of the normalConfidenceInterval defined above with: </p><div class="fragment"><div class="line">cl_double half_width = sqrt(variance / n) *</div>
<div class="line">          <a class="code" href="normal_8clh.html#a76cd59d390416fc2a83ef98488e7ef7e">clprobdistStdNormalInverseCDF</a>(0.5 * (1.0 + level), NULL);</div>
<div class="line">*lower = average - half_width;</div>
<div class="line">*upper = average + half_width;</div>
</div><!-- fragment --><p>The complete code for this example can be found in <a class="el" href="DocsTutorial_2example1_8c-example.html">DocsTutorial/example1.c</a>.</p>
<h2><a class="anchor" id="example_poissongen"></a>
Example 2: non-uniform variate generation</h2>
<p>In this example, we want to simulate a stochastic system (not completely specified as our focus here is the usage of clProbDist) that uses a number, say 100, of Poisson variates, all with the same mean <code>lambda</code>, as its input. To generate a Poisson variate with the inversion method, we first generate a pseudorandom number uniformly distributed in (0,1) using the MRG31k3p generator from the <a href="https://github.com/clMathLibraries/clRNG">clRNG library</a>, and we map the output through <a class="el" href="poisson_8clh.html#a7e5aa53733d0428dee495250ff4d4f9f" title="Inverse cumulative density function [device]. ">clprobdistPoissonInverseCDF()</a>. (The user is referred to the <a href="http://clmathlibraries.github.io/clRNG/htmldocs/index.html">clRNG documentation</a> and <a href="http://clmathlibraries.github.io/clRNG/docs/clrng-api.pdf">clRNG tutorial document</a> for instructions on random streams usage.) For simplicity, we assume that the Poisson variates are used sequentially, one at a time, so we do not need to store them all at once in advance. Again, we run everything on the host. The code to average 1024 realizations of the output of this stochastic system would look like this: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="poisson_8h.html">clProbDist/poisson.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;clRNG/mrg31k3p.h&gt;</span></div>
<div class="line"></div>
<div class="line">cl_double simulateOneRun(cl_double lambda, clrngMrg31k3pStream* stream)</div>
<div class="line">{</div>
<div class="line">    cl_double output = 0.0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 100; i++) {</div>
<div class="line">        cl_double u = clrngMrg31k3pRandomU01(stream);</div>
<div class="line">        cl_int poisson_variate = <a class="code" href="poisson_8clh.html#a7e5aa53733d0428dee495250ff4d4f9f">clprobdistPoissonInverseCDF</a>(lambda, u, NULL);</div>
<div class="line">        <span class="comment">// modify output using poisson_variate</span></div>
<div class="line">        output += poisson_variate;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> output;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// prepare</span></div>
<div class="line">    <span class="keywordtype">int</span> replications = 1024;</div>
<div class="line">    cl_double lambda = 50.0;</div>
<div class="line">    clrngMrg31k3pStream* stream = clrngMrg31k3pCreateStreams(NULL, 1, NULL, NULL);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// simulate</span></div>
<div class="line">    cl_double sum = 0.0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; replications; i++)</div>
<div class="line">        sum += simulateOneRun(lambda, stream);</div>
<div class="line">    printf(<span class="stringliteral">&quot;The average output is %.3f\n&quot;</span>, sum / replications);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// clean up</span></div>
<div class="line">    clrngMrg31k3pDestroyStreams(stream);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><p> Here, the output of <code>simulateOneRun()</code> is simply the sum of the 100 Poisson variates. In practice, it would be more elaborate, but the purpose of this example is to show how to generate nonuniform variates. The call to <code>clprobdistPoissonInverseCDF(lambda, u, NULL)</code> evaluates the inverse Poisson distribution function with mean <code>lambda</code> at quantile <code>u</code>, ignoring errors.</p>
<p>The complete code for this example can be found in <a class="el" href="DocsTutorial_2example2_8c-example.html">DocsTutorial/example2.c</a>.</p>
<p>The above code generates 1024 × 100 Poisson variates with the same mean, and can be very inefficient when <code>lambda</code> is large. A faster approach makes use of a lookup array to avoid repeating costly computations. Such facility is provided by a selection of functions of the Poisson distribution API, illustrated in <a class="el" href="index.html#example_poissongen_obj">Example 3: non-uniform variate generation revisited</a> below. For this purpose, we introduce <a class="el" href="index.html#dist_objects">Distribution objects</a>.</p>
<h2><a class="anchor" id="dist_objects"></a>
Distribution objects</h2>
<p>The API of each distribution comes in two variants. One uses distribution parameters as the first arguments of the functions; the other replaces the distribution parameters with a distribution object, and appends <code>WithObject</code> to the function names. <sup title="Alternatively, functions that take a distribution object could be
named without the `WithObject` suffix whereas functions that take distribution
parameters could be appended `WithParams` to their names.  But, this would
be inappropriate for the API of the standard normal distribution that takes
no explicit parameters (the mean and standard deviation are implicitly set
to 0 and 1, respectively).">[note]</sup></p>
<p>The type of a distribution object is specific to the distribution it represents, e.g., the Poisson distribution has objects of type <code>clprobdistPoisson</code>. A distribution object stores the parameters of the distribution it represents, and, for some distributions, it may also store additional data.</p>
<p>In particular, for discrete distributions such as the Poisson one, the distribution object also stores lookup arrays to speed up the evaluation of the probability, of the distribution function and its inverse, and of the reliability function. Building the lookup arrays cost some time, so it is advisable to use a distribution object especially when these functions need to be evaluated many times. Before before using a distribution object with these functions, it must be created using <a class="el" href="clProbDist__template_8h.html#a5998bd3a2cf31b9270acf6a7a567449b" title="Create a distribution object. ">clprobdistCreate()</a>; it can be destroyed with <a class="el" href="clProbDist__template_8h.html#a10bfcc96f4431616a09d4b825329e1ac" title="Destroy a distribution object. ">clprobdistDestroy()</a>.</p>
<p>For other distributions, it should make very little difference in terms of performance which variant of the distribution API is used (with distribution objects or distribution parameters).</p>
<p>In the <a class="el" href="clProbDist__template_8h.html">generic probability distribution API reference</a>, the generic type name for a distribution object is <a class="el" href="structclprobdistObject.html" title="Distribution object [device]. ">clprobdistObject</a>.</p>
<h2><a class="anchor" id="example_poissongen_obj"></a>
Example 3: non-uniform variate generation revisited</h2>
<p>Here, we modify <a class="el" href="index.html#example_poissongen">Example 2: non-uniform variate generation</a> to use a distribution object in order to accelerate the multiple evaluations of the inverse distribution function. First, <code>simulateOneRun()</code> needs to receive a distribution object instead of the mean of the Poisson distribution, so its signature becomes </p><div class="fragment"><div class="line">cl_double simulateOneRun(<span class="keyword">const</span> <a class="code" href="poisson_8clh.html#adf385749073392a9ca077c991c28f693">clprobdistPoisson</a>* dist, clrngMrg31k3pStream* stream)</div>
</div><!-- fragment --><p> Next, we replace the call to <a class="el" href="poisson_8clh.html#a7e5aa53733d0428dee495250ff4d4f9f" title="Inverse cumulative density function [device]. ">clprobdistPoissonInverseCDF()</a> to its variant that takes a distribution object: </p><div class="fragment"><div class="line">cl_int poisson_variate = <a class="code" href="poisson_8clh.html#a255017cef587d71995028a37e83a12ee">clprobdistPoissonInverseCDFWithObject</a>(dist, u, NULL);</div>
</div><!-- fragment --><p> Finally, we create the distribution object with: </p><div class="fragment"><div class="line"><a class="code" href="poisson_8clh.html#adf385749073392a9ca077c991c28f693">clprobdistPoisson</a>* dist = <a class="code" href="poisson_8h.html#a2641f494749362f33900ca2f6fc3c47d">clprobdistPoissonCreate</a>(50.0, NULL, NULL);</div>
</div><!-- fragment --><p> and pass it to <code>simulateOneRun()</code> instead of the value of the mean: </p><div class="fragment"><div class="line">sum += simulateOneRun(dist, stream);</div>
</div><!-- fragment --><p> The first argument to <a class="el" href="poisson_8h.html#a2641f494749362f33900ca2f6fc3c47d" title="Create a distribution object. ">clprobdistPoissonCreate()</a> is the value of distribution parameter \(\lambda\). For distributions with multiple parameters, their values would be listed as the first arguments to <a class="el" href="clProbDist__template_8h.html#a5998bd3a2cf31b9270acf6a7a567449b" title="Create a distribution object. ">clprobdistCreate()</a> (expanded to the proper name for the distribution). For instance, to create a distribution object for the normal distribution with mean <code>mu</code> and standard deviation <code>sigma</code>, we would call: </p><div class="fragment"><div class="line"><a class="code" href="normal_8clh.html#a91a769eb8eea7b2307e01afea64a2322">clprobdistNormal</a>* dist = <a class="code" href="normal_8h.html#a79d3bc7af23447cb322b3f4cf6680c5c">clprobdistNormalCreate</a>(mu, sigma, NULL, NULL);</div>
</div><!-- fragment --><p> The last two arguments to <a class="el" href="poisson_8h.html#a2641f494749362f33900ca2f6fc3c47d" title="Create a distribution object. ">clprobdistPoissonCreate()</a>, or to <a class="el" href="clProbDist__template_8h.html#a5998bd3a2cf31b9270acf6a7a567449b" title="Create a distribution object. ">clprobdistCreate()</a> in general, can be used to return the size of the created distribution object and the error status. Here, we ignore them by setting them to <code>NULL</code>.</p>
<p>The complete code for this example can be found in <a class="el" href="DocsTutorial_2example3_8c-example.html">DocsTutorial/example3.c</a>.</p>
<h2><a class="anchor" id="device_usage"></a>
Usage from device code</h2>
<p>Using clProbDist from device code is very similar to using it from host code. The device API variant that uses distribution parameters is the same as the host API. For example, to store in <code>p</code> the probability density of <code>x</code> in a normal distribution of mean \(\mu\) = <code>mu</code> and standard deviation \(\sigma\) = <code>sigma</code>, one would include the header file <a class="el" href="normal_8clh.html" title="Device-side API for the normal distribution. ">normal.clh</a> and invoke: </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> p = <a class="code" href="normal_8clh.html#a8170fca26c3da0ef3c6c707a76750ce5">clprobdistNormalDensity</a>(mu, sigma, x);</div>
</div><!-- fragment --><p> Here, <code>x</code>, <code>mu</code> and <code>sigma</code> are all floating-point values of type <code>double</code>.</p>
<p>The device API has no functions to create or destroy distribution objects. Besides that, it is almost the same as the host API. Here is an example kernel that receives a normal distribution object and uses it to invoke <a class="el" href="normal_8clh.html#a8170fca26c3da0ef3c6c707a76750ce5" title="Probability density function [device]. ">clprobdistNormalDensity()</a>: </p><div class="fragment"><div class="line">__kernel <span class="keywordtype">void</span> my_kernel(__global <span class="keyword">const</span> <a class="code" href="normal_8clh.html#a91a769eb8eea7b2307e01afea64a2322">clprobdistNormal</a>* dist)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> p = <a class="code" href="normal_8clh.html#a8170fca26c3da0ef3c6c707a76750ce5">clprobdistNormalDensity</a>(dist, 8.0, NULL);</div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p> Again, the last argument to <a class="el" href="normal_8clh.html#a8170fca26c3da0ef3c6c707a76750ce5" title="Probability density function [device]. ">clprobdistNormalDensity()</a>, that can be used for error reporting but is ignored here by setting it to <code>NULL</code>. It is possible to store the distribution objects into other memory types than global memory, but this requires additional instructions in the host and kernel codes. This is discussed in <a class="el" href="index.html#mem_types">Device memory types</a>.</p>
<h2><a class="anchor" id="example_poissongen_device"></a>
Example 4: Poisson variate generation on the device</h2>
<p>Here, we adapt <a class="el" href="index.html#example_poissongen_obj">Example 3: non-uniform variate generation revisited</a>, which runs on the host, to run on the device. First, we translate the computation code into device code, by replacing the extensions of the header names with <code>.clh</code> and by replacing <code>cl_double</code> with <code>double</code>, and by writing a kernel to receive data from the host, call <code>simulateOneRun()</code> and send data back to the host: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="poisson_8clh.html">clProbDist/poisson.clh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;clRNG/mrg31k3p.clh&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">double</span> simulateOneRun(__global <span class="keyword">const</span> <a class="code" href="poisson_8clh.html#adf385749073392a9ca077c991c28f693">clprobdistPoisson</a>* dist, clrngMrg31k3pStream* stream)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">double</span> output = 0.0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 100; i++) {</div>
<div class="line">        <span class="keywordtype">double</span> u = clrngMrg31k3pRandomU01(stream);</div>
<div class="line">        <span class="keywordtype">int</span> poisson_variate = <a class="code" href="poisson_8clh.html#a255017cef587d71995028a37e83a12ee">clprobdistPoissonInverseCDFWithObject</a>(dist, u, NULL);</div>
<div class="line">        <span class="comment">// modify output using poisson_variate</span></div>
<div class="line">        ...</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> output;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">__kernel <span class="keywordtype">void</span> my_kernel(</div>
<div class="line">    __global <span class="keyword">const</span> <a class="code" href="poisson_8clh.html#adf385749073392a9ca077c991c28f693">clprobdistPoisson</a>* dist,</div>
<div class="line">    __global <span class="keyword">const</span> clrngMrg31k3pHostStream* host_streams,</div>
<div class="line">    __global <span class="keywordtype">double</span>* output)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> gid = get_global_id(0);</div>
<div class="line">    clrngMrg31k3pStream stream;</div>
<div class="line">    clrngMrg31k3pCopyOverStreamsFromGlobal(1, &amp;stream, &amp;host_streams[gid]);</div>
<div class="line">    output[gid] = simulateOneRun(dist, &amp;stream);</div>
<div class="line">}</div>
</div><!-- fragment --><p> The <code>__global</code> OpenCL C keyword in front of <code>const clprobdistPoisson*</code> indicates that the Poisson distribution object is stored in the device's global memory.</p>
<p>The host code is responsible for creating the distribution object and sending it into the device's memory. The latter requires the size of the object to be known, so we allow <a class="el" href="poisson_8h.html#a2641f494749362f33900ca2f6fc3c47d" title="Create a distribution object. ">clprobdistPoissonCreate()</a> to return it in its second argument (<code>dist_buf_size</code>): </p><div class="fragment"><div class="line"><span class="keywordtype">size_t</span> dist_buf_size;</div>
<div class="line"><a class="code" href="poisson_8clh.html#adf385749073392a9ca077c991c28f693">clprobdistPoisson</a>* dist = <a class="code" href="poisson_8h.html#a2641f494749362f33900ca2f6fc3c47d">clprobdistPoissonCreate</a>(50.0, &amp;dist_buf_size, NULL);</div>
</div><!-- fragment --><p> After this instruction, <code>dist_buf_size</code> contains the size in bytes of the distribution object pointed to by <code>dist</code>. The size of the array is determined at runtime; it may vary depending on the value of the distribution parameter \(\lambda\), set to <code>50.0</code> here. An OpenCL buffer must be created to copy the distribution object into the device's memory: </p><div class="fragment"><div class="line">cl_mem dist_buf = clCreateBuffer(context, CL_MEM_READ_ONLY | CL_MEM_COPY_HOST_PTR, </div>
<div class="line">                                 dist_buf_size, dist, NULL);</div>
</div><!-- fragment --><p> In the above code snippet, the <code>context</code> variable is an OpenCL context. Finally, the buffer must be set as the first argument of the kernel (stored in the <code>kernel</code> variable): </p><div class="fragment"><div class="line">clSetKernelArg(kernel, 0, <span class="keyword">sizeof</span>(dist_buf), &amp;dist_buf);</div>
</div><!-- fragment --><p>The complete code for this example can be found in <a class="el" href="DocsTutorial_2example4_8c-example.html">DocsTutorial/example4.c</a> and <a class="el" href="DocsTutorial_2example4_kernel_8cl-example.html">DocsTutorial/example4_kernel.cl</a>.</p>
<h1><a class="anchor" id="configuration"></a>
Configuration</h1>
<h2><a class="anchor" id="environment"></a>
Environment variables</h2>
<p>For all features of the library to work properly, the <code>CLPROBDIST_ROOT</code> environment variable must be set to point to the installation path of the clProbDist package, that is, the directory under which lies the <code>include/clProbDist</code> subdirectory. Means of setting an environment variable depend on the operating system used.</p>
<h1><a class="anchor" id="mem_types"></a>
Device memory types</h1>
<p>The API of each distribution assumes that the distribution objects are stored in a specific type of memory. It defaults to global memory, but can be customized by the user by changing the value of the preprocessor symbol <code>CLPROBDIST_&lt;DIST&gt;_OBJ_MEM</code>, where <code>&lt;DIST&gt;</code> is the uppercase name of the distribution, before including the device header file of the distribution, to one of the following values:</p>
<ul>
<li>CLPROBDIST_MEM_TYPE_PRIVATE to use private memory (except for the Poisson distribution);</li>
<li>CLPROBDIST_MEM_TYPE_LOCAL to use local memory;</li>
<li>CLPROBDIST_MEM_TYPE_CONSTANT to use constant memory;</li>
<li>CLPROBDIST_MEM_TYPE_GLOBAL to use global memory (the <b>default</b>).</li>
</ul>
<p>For example, to store exponential distribution objects in <b>constant memory</b>, the device code should simply begin with: </p><div class="fragment"><div class="line"><span class="preprocessor">#define CLPROBDIST_EXPONENTIAL_OBJ_MEM CLPROBDIST_MEM_TYPE_CONSTANT</span></div>
<div class="line"><span class="preprocessor">#include &lt;clProbDist/exponential.clh&gt;</span></div>
</div><!-- fragment --><p><a class="anchor" id="clprobdistCopyOverFromGlobal"></a>For other memory types than global and constant memory, the device API provides a <code><a class="el" href="clProbDist__template_8h.html#a6041ab623dbe9bc2c09124eda6f4fd19" title="Copy a distribution object into already allocated memory [device-only]. ">clprobdistCopyOverFromGlobal()</a></code> function, where the <code>clprobdist</code> prefix has to be expanded with the distribution name as explained in <a class="el" href="index.html#prefixes">Distributions, prefixes and headers</a>. We give examples below of how to use this function.</p>
<p>To store exponential distribution objects in <b>private memory</b> instead, in addition to replacing <code>CLPROBDIST_MEM_TYPE_CONSTANT</code> with <code>CLPROBDIST_MEM_TYPE_PRIVATE</code>, each work item needs to make a private copy of the global distribution object and use the address of that copy with API calls, e.g., </p><div class="fragment"><div class="line"><span class="preprocessor">#define CLPROBDIST_EXPONENTIAL_OBJ_MEM CLPROBDIST_MEM_TYPE_PRIVATE</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="exponential_8clh.html">clProbDist/exponential.clh</a>&gt;</span></div>
<div class="line">__kernel <span class="keywordtype">void</span> example(__global <span class="keyword">const</span> <a class="code" href="exponential_8clh.html#a6bde6dad1ada2689aefe6d593d0a0ec8">clprobdistExponential</a>* gdist)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// allocate private storage for distribution object</span></div>
<div class="line">    <a class="code" href="exponential_8clh.html#a6bde6dad1ada2689aefe6d593d0a0ec8">clprobdistExponential</a> pdist;</div>
<div class="line">    <span class="comment">// copy distribution object from global memory to private memory</span></div>
<div class="line">    <a class="code" href="exponential_8clh.html#a859ad636939e6be4012c4913c4ed09c1">clprobdistExponentialCopyOverFromGlobal</a>(&amp;pdist, gdist);</div>
<div class="line">    <span class="comment">// following API calls should use &amp;pdist instead of gdist</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p>To store distribution objects in <b>local memory</b>, the user must first reserve local memory from the host code. For example, with a Poisson distribution object, the host code would include something like the following: </p><div class="fragment"><div class="line"><span class="comment">// create a Poisson distribution object</span></div>
<div class="line"><a class="code" href="poisson_8clh.html#adf385749073392a9ca077c991c28f693">clprobdistPoisson</a>* dist = <a class="code" href="poisson_8h.html#a2641f494749362f33900ca2f6fc3c47d">clprobdistPoissonCreate</a>(50.0, NULL, NULL);</div>
<div class="line"><span class="comment">// create OpenCL buffer for distribution object</span></div>
<div class="line"><span class="keywordtype">size_t</span> dist_size;</div>
<div class="line">dist_buf = clCreateBuffer(context,</div>
<div class="line">  CL_MEM_HOST_WRITE_ONLY | CL_MEM_READ_ONLY | CL_MEM_COPY_HOST_PTR, </div>
<div class="line">  dist_size, dist, &amp;err);</div>
<div class="line"><span class="comment">// send the distribution object in global memory</span></div>
<div class="line">clSetKernelArg(kernel, 0, <span class="keyword">sizeof</span>(dist_buf), &amp;dist_buf);</div>
<div class="line"><span class="comment">// allocate local memory to allow the device to copy the distribution object</span></div>
<div class="line">clSetKernelArg(kernel, 1, dist_size, NULL);</div>
</div><!-- fragment --><p> In the kernel, the distribution object must be copied from global memory to local memory, which is shared by all work items from the same work group. Perhaps the simplest way to do so is to have the first work item of each work group do the copy, e.g., </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="clProbDist_8clh.html">clProbDist/clProbDist.clh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#define CLPROBDIST_POISSON_OBJ_MEM CLPROBDIST_MEM_TYPE_LOCAL</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="poisson_8clh.html">clProbDist/poisson.clh</a>&gt;</span></div>
<div class="line">__kernel <span class="keywordtype">void</span> example(__global <span class="keyword">const</span> <a class="code" href="poisson_8clh.html#adf385749073392a9ca077c991c28f693">clprobdistPoisson</a>* gdist,</div>
<div class="line">                      __local        <a class="code" href="poisson_8clh.html#adf385749073392a9ca077c991c28f693">clprobdistPoisson</a>* ldist)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> gid = get_global_id(0);</div>
<div class="line">    <span class="keywordflow">if</span> (get_global_id(0) % get_local_size(0) == 0)</div>
<div class="line">        <span class="comment">// copy distribution object from global memory to local memory</span></div>
<div class="line">        <a class="code" href="poisson_8clh.html#afc4c757ee83b5f8809ded37e4c059212">clprobdistPoissonCopyOverFromGlobal</a>(ldist, gdist);</div>
<div class="line">    <span class="comment">// wait for all work items of the work group to be ready</span></div>
<div class="line">    barrier(CLK_LOCAL_MEM_FENCE);</div>
<div class="line">    <span class="comment">// following API calls should use ldist instead of gdist</span></div>
<div class="line">    ...</div>
<div class="line">}</div>
</div><!-- fragment --><p> This is substantially more complicated than using global memory. It may be faster or slower depending on the distribution and its parameters, the OpenCL hardware and the vendor implementation of OpenCL.</p>
<h1><a class="anchor" id="distributions"></a>
Implemented distributions</h1>
<p>The following table lists the distributions that are currently implemented in clProbDist with the type of their support (continuous or discrete), the prefix for functions of the distribution API, and the name of the corresponding header file on the host and on the device.</p>
<table class="doxtable">
<tr>
<th>Distribution </th><th>Support Type </th><th>Prefix </th><th>Host Header File </th><th>Device Header File  </th></tr>
<tr>
<td>Normal </td><td>continuous </td><td><code>clprobdistNormal</code> </td><td><a class="el" href="normal_8h.html" title="API of the normal distribution. ">normal.h</a> </td><td><a class="el" href="normal_8clh.html" title="Device-side API for the normal distribution. ">normal.clh</a> </td></tr>
<tr>
<td>Standard Normal </td><td>continuous </td><td><code>clprobdistStdNormal</code> </td><td><a class="el" href="normal_8h.html" title="API of the normal distribution. ">normal.h</a> </td><td><a class="el" href="normal_8clh.html" title="Device-side API for the normal distribution. ">normal.clh</a> </td></tr>
<tr>
<td>Lognormal </td><td>continuous </td><td><code>clprobdistLognormal</code> </td><td><a class="el" href="lognormal_8h.html" title="API of the lognormal distribution. ">lognormal.h</a> </td><td><a class="el" href="lognormal_8clh.html" title="Device-side API for the lognormal distribution. ">lognormal.clh</a> </td></tr>
<tr>
<td>Exponential </td><td>continuous </td><td><code>clprobdistExponential</code> </td><td><a class="el" href="exponential_8h.html" title="API of the exponential distribution. ">exponential.h</a> </td><td><a class="el" href="exponential_8clh.html" title="Device-side API for the exponential distribution. ">exponential.clh</a> </td></tr>
<tr>
<td>Gamma </td><td>continuous </td><td><code>clprobdistGamma</code> </td><td><a class="el" href="gamma_8h.html" title="API of the gamma distribution. ">gamma.h</a> </td><td><a class="el" href="gamma_8clh.html" title="Device-side API for the gamma distribution. ">gamma.clh</a> </td></tr>
<tr>
<td>Poisson </td><td>discrete </td><td><code>clprobdistPoisson</code> </td><td><a class="el" href="poisson_8h.html" title="API of the Poisson distribution. ">poisson.h</a> </td><td><a class="el" href="poisson_8clh.html" title="Device-side API for the Poisson distribution. ">poisson.clh</a> </td></tr>
</table>
<p>The API of continuous distributions provide a <a class="el" href="clProbDist__template_8h.html#a8844ff64e6c7e186c605037b7db4b26e" title="Probability density function [device]. ">clprobdistDensity()</a> function to compute the probability density; for discrete distributions, it is replaced by a <a class="el" href="clProbDist__template_8h.html#a317d877bc2ccd2992a48eed289365fe5" title="Probability mass function [device]. ">clprobdistProb()</a> function that computes the probability mass.</p>
<p>The common API for all distributions, in a generic form, is given in <a class="el" href="clProbDist__template_8h.html">clProbDist_template.h</a>. Some parts of the API vary across distributions, for instance, the type of return value of the inverse distribution function: <code>cl_double</code> for continuous distributions and <code>cl_int</code> for discrete distributions. This is in fact the type of the random variable described by the distribution, and its programmatic type is denoted by <code>vartype</code> in the generic API. Also, the number of distribution parameters vary, as well as their individual types and names. The token <code>DIST_PARAMS</code> substitutes for the list of distribution parameters in the generic API. The table below explicits the expansion of <code>vartype</code> and <code>DIST_PARAMS</code> for implemented distributions. The meaning of the distribution parameters is given below for each individual distribution.</p>
<table class="doxtable">
<tr>
<th>Distribution </th><th><code>vartype</code> </th><th><code>DIST_PARAMS</code><a class="anchor" id="DIST_PARAMS"></a>  </th></tr>
<tr>
<td>Normal </td><td><code>cl_double</code> </td><td><code>cl_double</code> \(\mu\), <code>cl_double</code> \(\sigma\) </td></tr>
<tr>
<td>Standard Normal </td><td><code>cl_double</code> </td><td><em>none</em> </td></tr>
<tr>
<td>Lognormal </td><td><code>cl_double</code> </td><td><code>cl_double</code> \(\mu\), <code>cl_double</code> \(\sigma\) </td></tr>
<tr>
<td>Exponential </td><td><code>cl_double</code> </td><td><code>cl_double</code> \(\lambda\) <code>cl_double</code> </td></tr>
<tr>
<td>Gamma </td><td><code>cl_double</code> </td><td><code>cl_double</code> \(\alpha\), <code>cl_double</code> \(\lambda\), <code>cl_int</code> \(d\) </td></tr>
<tr>
<td>Poisson </td><td><code>cl_int</code> </td><td><code>cl_double</code> \(\lambda\) </td></tr>
</table>
<p>In addition to the functions listed with generic API names in <a class="el" href="clProbDist__template_8h.html" title="Template of the API for specific probability distributions (not to be included as is!) ...">clProbDist_template.h</a>, each parameterized distribution exposes functions to retrieve the values of the parameters a distribution object was created with.</p>
<h2><a class="anchor" id="normal_dist"></a>
Normal distribution</h2>
<p>With mean \(\mu\) and variance \(\sigma^2\), where \(\sigma &gt; 0\), its density function is </p><p class="formulaDsp">
\[ f(x) = \frac{1}{\sqrt{2 \pi \sigma^2}} \exp\left[ \frac{-(x-\mu)^2}{2\sigma^2} \right] \qquad (-\infty &lt; x &lt; \infty). \]
</p>
<p>For the normal distribution, <a class="el" href="index.html#DIST_PARAMS">DIST_PARAMS</a> expands to: </p><div class="fragment"><div class="line">cl_double mu, cl_double sigma</div>
</div><!-- fragment --><p> where <code>mu</code> \(=\mu\) and <code>sigma</code> \(=\sigma\). The API of the normal distribution adds the functions <a class="el" href="normal_8clh.html#a130901c5f67296eabfa2cb70f6f35b8b" title="Return the mean. ">clprobdistNormalGetMu()</a> and <a class="el" href="normal_8clh.html#a356611a35cba44d091f602f210cdd60d" title="Return the standard deviation. ">clprobdistNormalGetSigma()</a> to retrieve the value of these parameters.</p>
<p>The CDF is evaluated using Uses the Chebyshev approximation proposed in <a class="el" href="citelist.html#CITEREF_tSCH78a">[6]</a>, which gives 16 decimals of precision. The inverse CDF is computed using different rational Chebyshev approximations <a class="el" href="citelist.html#CITEREF_tBLA76a">[2]</a>, which give 16 decimal digits of precision for \(2.2 \times 10^{-308} &lt; u &lt; 1\).</p>
<p>The complete API of the normal distribution is described in <a class="el" href="normal_8h.html" title="API of the normal distribution. ">normal.h</a>.</p>
<h2><a class="anchor" id="stdnormal_dist"></a>
Standard normal distribution</h2>
<p>This special case of the normal distribution with \(\mu = 0\) and \(\sigma = 1\) has distribution function </p><p class="formulaDsp">
\[ F(x) = \Phi(x) = \frac{1}{\sqrt{2 \pi}} \int_{-\infty}^x e^{-t^2/2} \,dt \qquad (-\infty &lt; x &lt; \infty). \]
</p>
<p>For the standard normal distribution, there are no free parameters, so <a class="el" href="index.html#DIST_PARAMS">DIST_PARAMS</a> expands to nothing.</p>
<p>The complete API of the standard normal distribution is also described in <a class="el" href="normal_8h.html" title="API of the normal distribution. ">normal.h</a>.</p>
<h2><a class="anchor" id="lognormal_dist"></a>
Lognormal distribution</h2>
<p>With scale parameter \(\mu\) and shape parameter \(\sigma^2\), where \(\sigma &gt; 0\), its density function is </p><p class="formulaDsp">
\[ f(x) = \frac{1}{\sqrt{2 \pi} \sigma x} \exp\left[ \frac{-(\ln x - \mu)^2}{2\sigma^2} \right] \qquad (0 &lt; x &lt; \infty). \]
</p>
<p> Its distribution function is </p><p class="formulaDsp">
\[ F(x) = \Phi((\ln x - \mu) / \sigma) \qquad (0 &lt; x &lt; \infty), \]
</p>
<p> where \(\Phi\) is the distribution function for the <a class="el" href="index.html#stdnormal_dist">Standard normal distribution</a>. This inverse distribution function is given by: </p><p class="formulaDsp">
\[ F^{-1}(u) = \exp\left[ \mu + \sigma\Phi^{-1}(u) \right] \qquad (0 \leq u &lt; 1). \]
</p>
<p> If \(\ln Y\) has a normal distribution, then \(Y\) has a lognormal distribution with the same parameters.</p>
<p>The CDF and inverse CDF are evaluated using the implementations for the normal distribution.</p>
<p>For the lognormal distribution, <a class="el" href="index.html#DIST_PARAMS">DIST_PARAMS</a> expands to: </p><div class="fragment"><div class="line">cl_double mu, cl_double sigma</div>
</div><!-- fragment --><p> where <code>mu</code> \(=\mu\) and <code>sigma</code> \(=\sigma\). The API of the normal distribution adds the functions <a class="el" href="lognormal_8clh.html#a0899a8a8a2b78055f77677f052d62d70" title="Return the scale parameter. ">clprobdistLognormalGetMu()</a> and <a class="el" href="lognormal_8clh.html#aa51046eda676f4500a9bedcfa4cc1f53" title="Return the shape parameter. ">clprobdistLognormalGetSigma()</a> to retrieve the value of these parameters.</p>
<p>The complete API of the normal distribution is described in <a class="el" href="lognormal_8h.html" title="API of the lognormal distribution. ">lognormal.h</a>.</p>
<h2><a class="anchor" id="exponential_dist"></a>
Exponential distribution</h2>
<p>With mean \(1/\lambda\), where \(\lambda &gt; 0\), its density, distribution and inverse distribution functions are, respectively, </p><p class="formulaDsp">
\begin{align} f(x) &amp;= \lambda e^{-\lambda x} &amp; (x \geq 0) \\ F(x) &amp;= 1 - e^{-\lambda x} &amp; (x \geq 0) \\ F^{-1}(x) &amp;= -\lambda^{-1} \ln(1 - u) &amp; (0 \leq u &lt; 1). \end{align}
</p>
<p> The inverse CDF is computed exactly with the above formula.</p>
<p>For the exponential distribution, <a class="el" href="index.html#DIST_PARAMS">DIST_PARAMS</a> expands to: </p><div class="fragment"><div class="line">cl_double lambda</div>
</div><!-- fragment --><p> where <code>lambda</code> \(=\lambda\). The API of the exponential distribution adds the function <a class="el" href="exponential_8clh.html#a8c1fbbbc8218158081dedd0cd7149dd2" title="Return the value of the inverse mean  [device]. ">clprobdistExponentialGetLambda()</a> retrieve the value of this parameter.</p>
<p>The complete API of the exponential distribution is described in <a class="el" href="exponential_8h.html" title="API of the exponential distribution. ">exponential.h</a>.</p>
<h2><a class="anchor" id="gamma_dist"></a>
Gamma distribution</h2>
<p>With shape parameter \(\alpha &gt; 0\) and scale parameter \(\lambda &gt; 0\), its density function is </p><p class="formulaDsp">
\[ f(x) = \frac{\lambda^\alpha x^{\alpha - 1} e^{\lambda x}}{\Gamma(\alpha)} \qquad (x &gt; 0), \]
</p>
<p> where </p><p class="formulaDsp">
\[ \Gamma(\alpha) = \int_0^\infty x^{\alpha - 1} e^{-x} \,dx \]
</p>
<p> is the usual gamma function. In particular, \(\Gamma(n) = (n - 1)!\) when \(n\) is a positive integer.</p>
<p>Several functions of the API for the gamma distribution are evaluated using an approximation with a precision of roughly \(d\) decimal digits, where \(d\) can be specified by the user. For consistency, \(d\) must always be specified, but is ignored by <a class="el" href="gamma_8clh.html#a3ed10dc522b4798500a7037e7819def1" title="Probability density function [device]. ">clprobdistGammaDensity()</a>, <a class="el" href="gamma_8clh.html#a9365924e6b0798324eaf75db5d014bf9" title="Mean of the distribution [device]. ">clprobdistGammaMean()</a>, <a class="el" href="gamma_8clh.html#a4ccc66c179e4a41904817c68438c4ad0" title="Standard deviation of the distribution [device]. ">clprobdistGammaStdDeviation()</a> and <a class="el" href="gamma_8clh.html#aebb0805233e016f053cae98edb71e85b" title="Variance of the distribution [device]. ">clprobdistGammaVariance()</a>.</p>
<p>The CDF is approximated with an improved version of the algorithm in <a class="el" href="citelist.html#CITEREF_tBHA70a">[1]</a> . The functions <a class="el" href="gamma_8clh.html#af1cf5b5e42bfd050f457559545fb175e" title="Cumulative density function [device]. ">clprobdistGammaCDF()</a> and <a class="el" href="gamma_8clh.html#af1d658caf4e59e761464078aec3a9295" title="Cumulative density function [device]. ">clprobdistGammaCDFWithObject()</a> try to return \(d\) decimals digits of precision. For \(\alpha\) not too large (e.g., \(\alpha \leq 1000\)), \(d\) gives a good idea of the precision attained. The inverse CDF \(F^{-1}(u)\) is approximated by solving \(F(x) - u = 0\) for \(x\) with the bisection method when \(u \leq 10^{-8}\) or \(\alpha \leq 1.5\), or with the Brent-Dekker method (see <a class="el" href="citelist.html#CITEREF_iBRE71a">[3]</a> and <a class="el" href="citelist.html#CITEREF_iBRE73a">[4]</a>) otherwise.</p>
<p>For the gamma distribution, <a class="el" href="index.html#DIST_PARAMS">DIST_PARAMS</a> expands to: </p><div class="fragment"><div class="line">cl_double alpha, cl_double lambda, cl_int decprec</div>
</div><!-- fragment --><p> where <code>alpha</code> \(=\alpha\), <code>lambda</code> \(=\lambda\) and <code>decprec</code> \(=d\). The API of the gamma distribution adds the functions <a class="el" href="gamma_8clh.html#a9008b2cf9a75d25ba7185edc4080f25a" title="Return the shape parameter of the distribution [device]. ">clprobdistGammaGetAlpha()</a> and <a class="el" href="gamma_8clh.html#a6706443e394eb70667bb465ea07a2ebb" title="Return the scale parameter of the distribution [device]. ">clprobdistGammaGetLambda()</a> to retrieve the value of the first two parameters.</p>
<p>The complete API of the gamma distribution is described in <a class="el" href="gamma_8h.html" title="API of the gamma distribution. ">gamma.h</a>.</p>
<h2><a class="anchor" id="poisson_dist"></a>
Poisson distribution</h2>
<p>With mean \(\lambda \geq 0\), its mass and distribution functions are, respectively, </p><p class="formulaDsp">
\begin{align} p(x) &amp;= \frac{e^{-\lambda} \lambda^x}{x!} &amp; (x = 0, 1, \ldots) \\ F(x) &amp;= e^{-\lambda} \sum_{j=0}^x \frac{\lambda^j}{j!} &amp; (x = 0, 1, \ldots) \end{align}
</p>
<p>When \(\lambda &gt; 200\), to compute \(F(x)\) and \(\bar F(x)\), <a class="el" href="poisson_8clh.html#acf008ebb9dd3c191165d20f883d8375b" title="Cumulative density function [device]. ">clprobdistPoissonCDF()</a> and <a class="el" href="poisson_8clh.html#ae15850b63ce71c0eca4ddbd97b9bffc2" title="Complementary CDF or reliability function [device]. ">clprobdistPoissonComplCDF()</a> exploit the relationship \(F(x) = 1 - G_{x+1}(\lambda)\), where \(G_{x+1}\) is the gamma distribution function with parameters \((\alpha, \lambda) = (x + 1, 1)\). Otherwise, the probabilities are summed term by term. To evaluate the inverse CDF \(F^{-1}(u)\), <a class="el" href="poisson_8clh.html#a7e5aa53733d0428dee495250ff4d4f9f" title="Inverse cumulative density function [device]. ">clprobdistPoissonInverseCDF()</a> performs a sequential search for the smallest value of \(x\) such that \(F(x) \geq u\), by incrementing \(x\) starting from \(x = 0\). When \(\lambda\) is very large, the probabilities \(p(x)\) are empirically negligible when \(x\) is far from \(\lambda\). So, when \(\lambda \geq 700\), the implementation of <a class="el" href="poisson_8clh.html#a7e5aa53733d0428dee495250ff4d4f9f" title="Inverse cumulative density function [device]. ">clprobdistPoissonInverseCDF()</a> starts with a binary search for the lower boundary \(x_{\mathrm{min}} \in \{0,\dots,\lambda\}\) of an interval that contains the non-negligible probability values. Then, the sequential search begins at \(x = x_{\mathrm{min}}\).</p>
<p>If one has to compute \(p(x)\) or \(F(x)\) for several values of \(x\) with the same \(\lambda\), where \(\lambda\) is not too large, then it is more efficient to instantiate an object and use the API variant that uses distribution objects of type clprobdistPoisson, e.g., <a class="el" href="poisson_8clh.html#a4fe7c29803f409282129e89bcab32ab4" title="Probability mass function [device]. ">clprobdistPoissonProbWithObject()</a> and <a class="el" href="poisson_8clh.html#a4ae9a59fb31f753e2b85facdebb0b5ae" title="Cumulative density function [device]. ">clprobdistPoissonCDFWithObject()</a>, for which return values are computed in advance and stored in lookup arrays. Probabilities smaller than \(10^{-16}\) are not stored in the Poisson distribution object, but are computed directly each time they are needed (which should be very seldom). The inverse CDF is evaluated by <a class="el" href="poisson_8clh.html#a255017cef587d71995028a37e83a12ee" title="Inverse cumulative density function [device]. ">clprobdistPoissonInverseCDFWithObject()</a> with a binary search.</p>
<p>For the Poisson distribution, <a class="el" href="index.html#DIST_PARAMS">DIST_PARAMS</a> expands to: </p><div class="fragment"><div class="line">cl_double lambda</div>
</div><!-- fragment --><p> where <code>lambda</code> \(=\lambda\). The API of the exponential distribution adds the function <a class="el" href="poisson_8clh.html#ab5f9448015e2fe3dddc9e7caeebdd197" title="Return the value of the mean  [device]. ">clprobdistPoissonGetLambda()</a> retrieve the value of this parameter.</p>
<p>The complete API of the Poisson distribution is described in <a class="el" href="poisson_8h.html" title="API of the Poisson distribution. ">poisson.h</a>. The device API expects Poisson distribution objects to be stored into global memory by default. See <a class="el" href="index.html#mem_types">Device memory types</a> for information on using other types of memory.</p>
<p><b>WARNING:</b> The complementary distribution function, which can be evaluated with <a class="el" href="poisson_8clh.html#ae15850b63ce71c0eca4ddbd97b9bffc2" title="Complementary CDF or reliability function [device]. ">clprobdistPoissonComplCDF()</a> and <a class="el" href="poisson_8clh.html#a0abce120583681e8cb82a2f23822f180" title="Complementary CDF or reliability function [device]. ">clprobdistPoissonComplCDFWithObject()</a>, is defined as \(\bar F(j) = \mathbb P[X \geq j]\) (for integers \(j\)), so that for the Poisson distribution clProbDist, \(F(j) + \bar F(j) \neq 1\) since both include the term \(\mathbb P[X = j]\). </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 3 2016 09:33:43 for clProbDist by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
